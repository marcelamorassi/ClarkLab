---
title: "Experiment_1"
author: "Marcela Morassi"
date: "10/22/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggpubr)
library(RColorBrewer)
library(rcompanion)
library(dplyr)
library(ggplot2)
library(ggforce)
library(vegan)
theme_set(theme_classic()) # Set the theme

setwd("C:/Users/Marcela Morassi/Documents/Github/ClarkLab")
#working on campus
setwd("C:/Users/mm92384/Downloads/ClarkLab-master/ClarkLab-master")

data1 <- read.csv("data_experiment1_j_noNG.csv")
data1_new <- read.csv("experiment1_j_new.csv")

data2 <- read.csv("jennidata.csv")
```

Amy's set up
```{r}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "C:/Users/hrusk/Dropbox (Smithsonian)/2021_SummerInterns/MM")
setwd("C:/Users/hrusk/Dropbox (Smithsonian)/2021_SummerInterns/MM")

data1 <- read.csv("data_experiment1_j_noNG.csv")
data1_NG <- read.csv("data_experiment1_j.csv")
data2 <- read.csv("data_experiment1_m_noNG.csv")

```



BarStats Function 
```{r}
#barGraphStats(data=, variable="", byFactorNames=c(""))
barGraphStats <- function(data, variable, byFactorNames) {
  count <- length(byFactorNames)
  N <- aggregate(data[[variable]], data[byFactorNames], FUN=length)
  names(N)[1:count] <- byFactorNames
  names(N) <- sub("^x$", "N", names(N))
  mean <- aggregate(data[[variable]], data[byFactorNames], FUN=mean)
  names(mean)[1:count] <- byFactorNames
  names(mean) <- sub("^x$", "mean", names(mean))
  sd <- aggregate(data[[variable]], data[byFactorNames], FUN=sd)
  names(sd)[1:count] <- byFactorNames
  names(sd) <- sub("^x$", "sd", names(sd))
  preSummaryStats <- merge(N, mean, by=byFactorNames)
  finalSummaryStats <- merge(preSummaryStats, sd, by=byFactorNames)
  finalSummaryStats$se <- finalSummaryStats$sd / sqrt(finalSummaryStats$N)
  return(finalSummaryStats)
}

```


Data Manipulation
```{r}
data1[is.na(data1)] <- 0

#turning data discrete
data1_new <- data1_new %>% 
  mutate(ATP_conc = as.character(ATP_conc)) %>% 
  filter(root>0)

#SE
SE <- data1_new %>% 
  group_by(genotype, ATP_conc) %>% 
  filter(day==7) %>% 
  summarise(mean_root = mean(root), se = sd(root)  / sqrt(n()))

#formatting as date
as.Date(data1_new$date_time, "%m/%d/%Y %H:%M")

#making it into a discrete variable
data1_new$ATP_conc_new <- cut(data1_new$ATP_conc, br=c(1,137.5))


data1_KO_control <- data1_new %>% filter(genotype == "KO", day ==7, root>0, ATP_conc ==0)
data1_KO_treatment <- data1_new %>% filter(genotype == "KO", day==7, root>0, ATP_conc >0)
data1_WT_control <- data1_new %>% filter(genotype == "WT", day==7, root>0, ATP_conc ==0)
data1_WT_treatment <- data1_new %>% filter(genotype == "WT", day==7, root>0, ATP_conc >0)

data2_KO_control <- data2 %>% filter(genotype == "KO", day ==7, root>0, ATP_conc ==0)
data2_KO_treatment <- data2 %>% filter(genotype == "KO", day==7, root>0, ATP_conc >0)
data2_WT_control <- data2 %>% filter(genotype == "WT", day==7, root>0, ATP_conc ==0)
data2_WT_treatment <- data2 %>% filter(genotype == "WT", day==7, root>0, ATP_conc >0)


```

Growth Rate
```{r}
data1_new %>% 
  filter(genotype == "WT") %>% 
  ggplot(aes(x=day_date, y = root, color=ATP_conc)) +
  geom_point()


```



Significance tests (j)
```{r}

#day7 root length
exp1_day7 <- data1_new %>% 
  filter(day==7)

t.test(root ~ ATP_conc, genotype == "WT", data = exp1_day7, var.equal=FALSE, conf.level=0.95)
 
#growth rate
data1_WT_nozero <- data1 %>% filter(genotype == "WT", mean_growthrate > 0)
growthrate_tableWT <- xtabs(mean_growthrate~genotype+ATP_conc,aggregate(mean_growthrate~genotype+ATP_conc,data1_WT_nozero,mean))

t.test(growthrate_tableWT)

data1_KO_nozero <- data1 %>% filter(genotype == "KO", mean_growthrate > 0)
growthrate_tableKO <- xtabs(mean_growthrate~genotype+ATP_conc,aggregate(mean_growthrate~genotype+ATP_conc,data1_KO_nozero,mean))

t.test(growthrate_tableKO)


```


Significance tests (m)
```{r}



```


Data visualization
```{r}

#growth rate bar graph
data1 %>% filter(mean_growthrate > 0) %>%  
  ggplot(aes(x = genotype, y = mean_growthrate, fill = ATP_conc, group = factor (ATP_conc))) + geom_bar(stat="identity", position = position_dodge())

ggsave("growthrate_j.png")

data2 %>%  filter (mean_growthrate > 0) %>% 
  ggplot(aes(x = genotype, y = mean_growthrate, fill = ATP_conc, group = factor (ATP_conc))) + geom_bar(stat="identity", position = position_dodge())

ggsave("growthrate_m.png")

#day7 root length bar graph
data1_j_day7 <- data1_new %>% filter(day == 7)
data1_j_day7$genotype <- factor(data1_j_day7$genotype)

ggplot(SE, aes(x = genotype, y = mean_root, fill = ATP_conc, group = factor (ATP_conc))) +
  geom_col(stat="identity", position = position_dodge())+
  geom_linerange( aes(ymin = mean_root - se, ymax = mean_root + se),  width=.2,                    # Width of the error bars
                  position=position_dodge(.9))

data1_new %>% filter(day == 7) %>%  ggplot(aes(x = genotype, y = root, fill = ATP_conc, group = factor (ATP_conc))) + geom_bar(stat="identity", position = position_dodge()) +
  geom_errorbar(aes(ymin=root-se, ymax=root+se),
                  width=.2,                    # Width of the error bars
                  position=position_dodge(.9))

```


Data Summary
```{r}
sd(data2_KO %>% select(genotype, ATP_conc, day7_root, mean_growthrate) %>% filter(mean_growthrate>0, ATP_conc == 7.5))

data2_WT %>% select(genotype, ATP_conc, day7_root, mean_growthrate) %>% filter(mean_growthrate>0, ATP_conc == 7.5) %>% summary()

data1_WT %>% select(genotype, ATP_conc, day7_root, mean_growthrate) %>% filter(mean_growthrate>0, ATP_conc == 137.5) %>% summary()

```




