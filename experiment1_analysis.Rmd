---
title: "Experiment_1"
author: "Marcela Morassi"
date: "10/22/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggpubr)
library(RColorBrewer)
library(rcompanion)
library(dplyr)
library(ggplot2)
library(ggforce)
library(vegan)
theme_set(theme_classic()) # Set the theme

setwd("C:/Users/Marcela Morassi/Documents/Github/ClarkLab")

data1 <- read.csv("data_experiment1_j_noNG.csv")
data1_NG <- read.csv("data_experiment1_j.csv")

data2 <- read.csv("data_experiment1_m_noNG.csv")
```

BarStats Function 
```{r}
#barGraphStats(data=, variable="", byFactorNames=c(""))
barGraphStats <- function(data, variable, byFactorNames) {
  count <- length(byFactorNames)
  N <- aggregate(data[[variable]], data[byFactorNames], FUN=length)
  names(N)[1:count] <- byFactorNames
  names(N) <- sub("^x$", "N", names(N))
  mean <- aggregate(data[[variable]], data[byFactorNames], FUN=mean)
  names(mean)[1:count] <- byFactorNames
  names(mean) <- sub("^x$", "mean", names(mean))
  sd <- aggregate(data[[variable]], data[byFactorNames], FUN=sd)
  names(sd)[1:count] <- byFactorNames
  names(sd) <- sub("^x$", "sd", names(sd))
  preSummaryStats <- merge(N, mean, by=byFactorNames)
  finalSummaryStats <- merge(preSummaryStats, sd, by=byFactorNames)
  finalSummaryStats$se <- finalSummaryStats$sd / sqrt(finalSummaryStats$N)
  return(finalSummaryStats)
}

```


Data Manipulation
```{r}
data1[is.na(data1)] <- 0

#crude growth rate mutations
data1 <- data1 %>%  
  mutate(total_growth = day7_root - day3_root) %>% 
  mutate(growthrate1 = (day4_root - day3_root)/24.5) %>% 
  mutate(growthrate2 = (day5_root - day4_root)/23) %>% 
  mutate(growthrate3 = (day6_root - day5_root)/24.3) %>% 
  mutate(growthrate4 = (day7_root - day6_root)/23) %>% 
  mutate(mean_growthrate = (growthrate1 + growthrate2 + growthrate3 + growthrate4)/4)

data2 <- data2 %>%  
  mutate(total_growth = day7_root - day3_root) %>% 
  mutate(growthrate1 = (day4_root - day3_root)/24.5) %>% 
  mutate(growthrate2 = (day5_root - day4_root)/23) %>% 
  mutate(growthrate3 = (day6_root - day5_root)/24.3) %>% 
  mutate(growthrate4 = (day7_root - day6_root)/23) %>% 
  mutate(mean_growthrate = (growthrate1 + growthrate2 + growthrate3 + growthrate4)/4)

#combining date and time
data1 %>% mutate(day3 = coalesce(day3_date, day3_time)) 


#formatting as date
data1$day3_date <- as.Date(data1$day3_date, "%m/%d/%Y %H:%M")
data1$day4_date <- as.Date(data1$day4_date, "%m/%d/%Y")
data1$day5_date <- as.Date(data1$day5_date, "%m/%d/%Y")
data1$day6_date <- as.Date(data1$day6_date, "%m/%d/%Y")
data1$day7_date <- as.Date(data1$day7_date, "%m/%d/%Y") 


data1$day3_datehour <- cut(as.POSIXct(paste(data1$day3_date, data1$day3_time),
   format="%m/%d/%Y %H:%M:%S"), breaks="hour") 


```

Significance tests (j)
```{r}
library(reshape2)
day7_table <- dcast(data1, genotype~ATP_conc, value.var='day7_root', mean)

xtabs(day7_root~genotype+ATP_conc,aggregate(day7_root~genotype+ATP_conc,data1,mean))

#day7 root length
data1_KO <- data1 %>% filter(genotype == "KO") %>% select(genotype, ATP_conc, day7_root)
day7_tableKO <- xtabs(day7_root~genotype+ATP_conc,aggregate(day7_root~genotype+ATP_conc,data1_KO,mean))
day7_tableKO

t.test(data1_KO)

data1_WT <- data1 %>% filter(genotype == "WT")
day7_tableWT <- xtabs(day7_root~genotype+ATP_conc,aggregate(day7_root~genotype+ATP_conc,data1_WT,mean))
day7_tableWT

t.test(day7_tableWT)

#growth rate
data1_WT_nozero <- data1 %>% filter(genotype == "WT", mean_growthrate > 0)
growthrate_tableWT <- xtabs(mean_growthrate~genotype+ATP_conc,aggregate(mean_growthrate~genotype+ATP_conc,data1_WT_nozero,mean))

t.test(growthrate_tableWT)

data1_KO_nozero <- data1 %>% filter(genotype == "KO", mean_growthrate > 0)
growthrate_tableKO <- xtabs(mean_growthrate~genotype+ATP_conc,aggregate(mean_growthrate~genotype+ATP_conc,data1_KO_nozero,mean))

t.test(growthrate_tableKO)


```


Significance tests (m)
```{r}

#day7 root length
data2_KO <- data2 %>% filter(genotype == "KO", day7_root >0)
day7_tableKO_m <- xtabs(day7_root~genotype+ATP_conc,aggregate(day7_root~genotype+ATP_conc,data2_KO,mean))
day7_tableKO_m

t.test(day7_tableKO_m)

data2_WT <- data2 %>% filter(genotype == "WT", day7_root >0)
day7_tableWT_m <- xtabs(day7_root~genotype+ATP_conc,aggregate(day7_root~genotype+ATP_conc,data2_WT,mean))
day7_tableWT_m

t.test(day7_tableWT_m)

#growth rate
data1_WT_nozero <- data1 %>% filter(genotype == "WT", mean_growthrate > 0)
growthrate_tableWT <- xtabs(mean_growthrate~genotype+ATP_conc,aggregate(mean_growthrate~genotype+ATP_conc,data1_WT_nozero,mean))

t.test(growthrate_tableWT)

data1_KO_nozero <- data1 %>% filter(genotype == "KO", mean_growthrate > 0)
growthrate_tableKO <- xtabs(mean_growthrate~genotype+ATP_conc,aggregate(mean_growthrate~genotype+ATP_conc,data1_KO_nozero,mean))

t.test(growthrate_tableKO)


```


Data visualization
```{r}

#growth rate bar graph
data1 %>% filter(mean_growthrate > 0) %>%  
  ggplot(aes(x = genotype, y = mean_growthrate, fill = ATP_conc, group = factor (ATP_conc))) + geom_bar(stat="identity", position = position_dodge())

ggsave("growthrate_j.png")

data2 %>%  filter (mean_growthrate > 0) %>% 
  ggplot(aes(x = genotype, y = mean_growthrate, fill = ATP_conc, group = factor (ATP_conc))) + geom_bar(stat="identity", position = position_dodge())

ggsave("growthrate_m.png")

#day7 root length bar graph
ggplot(day7_table, aes(x = genotype, y = day7_root, fill = ATP_conc, group = factor (ATP_conc))) + geom_bar(stat="identity", position = position_dodge())

```


Data Summary
```{r}
sd(data2_KO %>% select(genotype, ATP_conc, day7_root, mean_growthrate) %>% filter(mean_growthrate>0, ATP_conc == 7.5))

data2_WT %>% select(genotype, ATP_conc, day7_root, mean_growthrate) %>% filter(mean_growthrate>0, ATP_conc == 7.5) %>% summary()

data1_WT %>% select(genotype, ATP_conc, day7_root, mean_growthrate) %>% filter(mean_growthrate>0, ATP_conc == 137.5) %>% summary()

```




